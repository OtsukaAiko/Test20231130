version: 1.0
runtime: python3
build:
  env:
    - name: PYTHONUNBUFFERED
      value: 1
  commands:
    pre-build:
      # AWS X-Ray deamon
      - curl https://s3.dualstack.ap-northeast-1.amazonaws.com/aws-xray-assets.ap-northeast-1/xray-daemon/aws-xray-daemon-3.x.rpm -o ./aws-xray-daemon-3.x.rpm
      - yum install ./aws-xray-daemon-3.x.rpm
      # SQL DB Driver
      - curl https://packages.microsoft.com/config/rhel/8/prod.repo > /etc/yum.repos.d/mssql-release.repo
      - yum remove unixODBC-utf16 unixODBC-utf16-devel
      - ACCEPT_EULA=Y yum install -y msodbcsql18
      - echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bashrc
      - source ~/.bashrc
      - sudo yum install -y unixODBC-devel
      # install gcc
      - yum install gcc
      - yum install python3-devel
    build:
      - pip install poetry
      - poetry config virtualenvs.create false
      - poetry update
      - chmod 744 ./startup.sh

run:
  runtime-version: 3.8
  command: ./startup.sh
  network:
    port: 8000
